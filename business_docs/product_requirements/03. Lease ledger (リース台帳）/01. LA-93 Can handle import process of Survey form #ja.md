JIRA Story URL: https://moneyforward.atlassian.net/browse/LA-93

Related Epic URL: https://moneyforward.kibe.la/notes/318947 

## User Stories

As an accountant or a department staff who entered the survey form, we would like to import the entered survey form (in Excel) into the system and check the latest survey status and lease identification results.
Because accountants are expected to share the progress of the survey and the latest status of the lease identification results.
So that, after uploading the Excel file in the Import Survey form modal, the results imported are displayed in the List of Survey form screen.

## Requirements

| No. | **Given**<br><span style="color: rgb(38, 38, 38)">Initial State</span> | **When**<br><span style="color: rgb(38, 38, 38)">Action</span> | **Then**<br><span style="color: rgb(38, 38, 38)">Expected Result</span> | 
| --- | --- | --- | --- |
| 1 | The "調査票/Survey form" screen is open | Click the "インポート/Import" button in the upper right corner<br><img src='/attachments/551b96c9-21c5-411a-872c-76afd1ded956' title='image.png' alt='image' width='1261' data-meta='{"width":1261,"height":769}'> | ・The Survey form import modal is displayed<br>・If the file is not selected, the インポート/Import button will be disabled <br><img src='/attachments/d18287fc-3b05-4542-8332-9be0a84af663' title='image.png' alt='image' width='606' data-meta='{"width":606,"height":600}'> | 
| 2 | The import modal for the Survey form is open | From "ファイルを選択/Select File", <br>upload the file<br>or <br>drag & drop the file into the インポートエリア/import area | The file is uploaded<br><img src='/attachments/39e8bb12-2955-4871-b4d3-ba6624479a03' title='image.png' alt='image' width='2560' data-meta='{"width":2560,"height":1600}'> | 
| 3 | File is uploaded | Press Import button | About import process<br>・Import process is executed<br>・If users go to another screen during import process, the process still continues<br>・**Import is not overwrite, but just add**<br><br>About file import<br>・Import data named "**インポート用/for import**" is imported as survey data<br>・The import file at the time of import is kept as it is (※We would like to be able to download the file at that time by using the history management function for starting subsequent development) | 
| 4 | User A and User B try to import at the same time | Both of them press the Import button | Multiple people can import at the same time | 
| 5 | The sheet name in the file to be uploaded is "インポート用/for import" AND the header has one or more information defined in the template | Click the Import button | Import succeeds | 
| 6 | The order of columns in the file to be uploaded is different from that defined in the template (but column names match) | Click the Import button | Import succeeds | 
| 7 | Some columns in the file to be uploaded are missing than defined in the template | Click the Import button | \- Import succeeds<br>- Only the matches are imported | 
| 8 | Some columns in the file to be uploaded are not specified in the template | Press the Import button | \- Import succeeds<br>- Columns not specified in the template are ignored | 
| 9 | There is a line in the middle of the file to be uploaded that contains no data at all | Click the Import button | The next line will be imported, ignoring empty line. | 
| ⁠10 | Import modal is open | Click X button or キャンセル/Cancel button on the modal | The import modal is closed<br><img src='/attachments/e43fdf8d-0f79-4be3-b065-162a14bbd871' title='image.png' alt='image' width='445' data-meta='{"width":445,"height":429}'> | 

### Remarks

* Reflecting data in list screen is created in a separate story
* Handling of import errors is created in a separate story
* Automatic lease identification logic is created in a separate story
* <span style="color: rgb(55, 65, 81)">The calculation logic for the "items requiring automatic calculation" displayed on the Collection screen will be created in a separate story.</span>

=======================================================================

# 調査票Excelを取り込む処理ができる

## ⁠ユーザストーリー

* **調査票を入力した経理担当者・部門担当者は、 入力済みの調査票（Excel）をシステムに取り込み、最新の調査状況とリース判定結果を確認**したい。
  なぜなら**経理担当者は、調査の進捗や、リース判定結果の最新状態を共有することが求められているため。**
  そのために、**調査票のインポートモーダルでExcelファイルをアップロードした後、調査票の一覧画面で取り込んだ結果を表示する。**

## 要件

| No. | **Given**<br><span style="color: rgb(38, 38, 38)">初期状態</span> | **When**<br><span style="color: rgb(38, 38, 38)">アクション</span> | **Then**<br><span style="color: rgb(38, 38, 38)">期待される結果</span> | 
| --- | --- | --- | --- |
| 1 | 「調査票」画面が開かれている | 右上の「インポート」ボタンを押下<br><img src='/attachments/1cb3bd32-7859-4afe-b60e-54fb69a0645e' title='image.png' alt='image' width='1261' data-meta='{"width":1261,"height":769}'> | ・調査票のインポートモダールが表示される<br>・ファイルが選択されていない場合、インポートボタンが非活性で表示される<br><img src='/attachments/8e98a278-f0af-4f6a-9b34-c61dfad0742c' title='image.png' alt='image' width='606' data-meta='{"width":606,"height":600}'> | 
| 2 | 調査票のインポートモダールが開かれている | 「ファイルを選択」から<br>ファイルをアップロードする<br>もしくは<br>インポートエリアにファイルをドラッグ＆ドロップする | ファイルがアップロードされる<br><img src='/attachments/2b337976-0378-43ed-856a-23b530cc6ea9' title='image.png' alt='image' width='2560' data-meta='{"width":2560,"height":1600}'> | 
| ⁠3 | ファイルがアップロードされる | 取り込みボタンを押下 | インポート処理について<br>・インポート処理が実行される<br>・インポート処理中に他の画面に行っても処理が続けられる<br>・**インポートは全上書きではなく 追加**される<br><br>ファイル取り込みについて<br>・**インポート用**というシート名のデータを調査票のデータとして取り込む<br>・取り込み時のインポートファイルはそのまま保持しておくこととする（※後続開発着手の履歴管理機能で当時のファイルをダウンロードできるようにしたい） | 
| ⁠4 | ユーザーAとユーザーBが<br>同時に取り込もうとする | 二人とも取り込みボタンを押下 | 複数人が同時にインポートすることができる | 
| ⁠5 | アップロードするファイル内にあるシート名が「インポート用」だが、中身のカラムは、テンプレートに定義されている情報が1つ以上ある | 取り込みボタンを押下 | インポートに成功する | 
| ⁠6 | アップロードするファイル内にあるカラムの順序がテンプレートに定義されている通りと違う（※カラム名が一致している） | 取り込みボタンを押下 | インポートに成功する | 
| ⁠7 | アップロードするファイル内にあるカラムがテンプレートに定義されているより一部不足している | 取り込みボタンを押下 | ・インポートに成功する<br>・一致しているものだけ取り込める | 
| ⁠8 | アップロードするファイル内にあるカラムは一部テンプレート指定外のものが入っている | 取り込みボタンを押下 | ・インポートに成功する<br>・テンプレートに指定しないカラムは無視される | 
| ⁠9 | アップロードするファイル内に全くデータがない行が途中行に入っている | 取り込みボタンを押下 | その行を無視して次の行が取り込まれる | 
| 10 | インポートモーダルが開かれている | モダール上の「X」ボタンもしくは「キャンセル」ボタンを押下 | インポートモーダルが閉じられる<br><img src='/attachments/00e5fab5-64a5-4a1a-bfa7-85d037953e64' title='image.png' alt='image' width='445' data-meta='{"width":445,"height":429}'> | 

### 備考

* 一覧画面に表示される内容は、別のストーリで作成
* 取り込みエラーのハンドリングは、別のストーリで作成
* リース自動判定ロジックは、別のストーリで作成
* <span style="color: rgb(0, 0, 0)">Collection画面に表示される「自動計算が必要な項目」の計算ロジックは</span>別のストーリで作成
